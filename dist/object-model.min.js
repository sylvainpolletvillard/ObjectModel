/*!
 * Objectmodel v3.1.0
 * http://objectmodel.js.org
 *
 * Copyright (c) 2017 Sylvain Pollet-Villard
 * Licensed under the MIT license
 */

!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.window=n.window||{})}(this,function(n){"use strict";function t(n){let e=function(n=e.default){return e.validate(n)?n:void 0};return R(e,t),q(e,n),e}function e(n,t){let i=function(n=i.default){let t=this;return h(i,t)?h(i,n)?n:(F(t,i[c](n),!0),i.validate(t)?K(i,t,i.definition):void 0):new i(n)};return Object.assign(i,t),A(i,Object),R(i,e),q(i,n),i}function i(n,i){return b(n)?new e(n,i):new t(n)}function r(n){let t=function(n=t.default){if(t.validate(n))return P(n,t,{get(e,i){let r=e[i];return g(r)?w(r,(r,o,u)=>{if(L.includes(i)){let n=e.slice();r.apply(n,u),t.validate(n)}let f=r.apply(e,u);n.forEach((n,i)=>e[i]=I(n,t.definition));return f}):r},set(n,e,i){return Q(n,e,i,t)},deleteProperty(n,e){return!(e in n)||Q(n,e,void 0,t)}})};return A(t,Array),R(t,r),q(t,n),t}function o(...n){let t=function(n=t.default){if(t.validate(n))return P(n,t,{apply(n,e,i){let r=t.definition;r.arguments.forEach((n,e)=>{i[e]=N(i[e],n,`arguments[${e}]`,t.errors,[])}),B(i,t,"arguments");let o;return t.errors.length||(o=Reflect.apply(n,e,i),"return"in r&&(o=N(o,r.return,"return value",t.errors,[]))),J(t),o}})};return A(t,Function),R(t,o),q(t,{arguments:n}),t}function u(n,t){let e=function(n=e.default){let t=n=>["key","value"].map((t,i)=>I(n[i],e.definition[t])),i=new Map([...n].map(t));if(e.validate(i))return P(i,e,{get(n,i){let r=n[i];return g(r)?w(r,(r,o,u)=>{"set"===i&&(u=t(u));if(V.includes(i)){let t=new Map(n);r.apply(t,u),e.validate(t)}return r.apply(n,u)}):r}})};return A(e,Map),R(e,u),q(e,{key:n,value:t}),e}function f(n){let t=function(n=t.default){let e=n=>I(n,t.definition),i=new Set([...n].map(e));if(t.validate(i))return P(i,t,{get(n,i){let r=n[i];return g(r)?w(r,(r,o,u)=>{"add"===i&&(u[0]=e(u[0]));if(W.includes(i)){let e=new Set(n);r.apply(e,u),t.validate(e)}return r.apply(n,u)}):r}})};return A(t,Set),R(t,f),q(t,n),t}const c="_constructor",s="_validate",a=Object.prototype,l=n=>a.toString.call(n).match(/\s([a-zA-Z]+)/)[1],d=Object.getPrototypeOf,p=(n,t)=>n.hasOwnProperty(t),h=(n,t)=>t instanceof n,y=n=>"string"==typeof n,g=n=>"function"==typeof n,v=n=>"object"==typeof n,m=n=>Array.isArray(n),b=n=>n&&v(n)&&d(n)===a,j=n=>n&&h(i,d(n).constructor),O=(n,t)=>new Proxy(n,t),w=(n,t)=>O(n,{apply:t}),P=(n,t,e)=>O(n,Object.assign({getPrototypeOf:()=>t.prototype},e)),M=(n,t)=>{t.errors.push({message:"cannot "+n})},S=(n,t)=>n?n+"."+t:t,x=(n,t)=>Object.keys(n).map(t);let F=(n,t={},e)=>{for(let i in t)if(e&&b(t[i])){let r={};F(r,n[i],e),F(r,t[i],e),n[i]=r}else n[i]=t[i]},k=(n,t,e,i=!1)=>{Object.defineProperty(n,t,{value:e,enumerable:i,writable:!0,configurable:!0})},R=(n,t)=>{Object.setPrototypeOf(n,t.prototype);k(n,"constructor",t)},A=(n,t,e)=>{n.prototype=Object.assign(Object.create(t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e);Object.setPrototypeOf(n,t)},C=(n,t=[])=>{if(t.length>15||t.includes(n))return"...";if(null===n||void 0===n)return String(n);if(y(n))return`"${n}"`;if(h(i,n))return n.toString(t);t.unshift(n);if(g(n))return n.name||n.toString(t);if(h(Map,n)||h(Set,n))return C([...n]);if(m(n))return`[${n.map(n=>C(n,t)).join(", ")}]`;if(n.toString!==Object.prototype.toString)return n.toString();if(n&&v(n)){let e=Object.keys(n),i="\t".repeat(t.length);return`{${e.map(e=>`\n${i+e}: ${C(n[e],t.slice())}`).join(",")} ${e.length?`\n${i.slice(1)}`:""}}`}return String(n)},E=n=>{if(b(n))x(n,t=>{n[t]=E(n[t])});else{if(!m(n))return[n];if(1===n.length)return[...n,void 0,null]}return n},_=(n,t)=>E(n).map(n=>C(n,t)).join(" or "),D=(n,t=[])=>{m(t)||(t=[t]);t.length>0&&(n=t.reduce((n,t)=>n.concat(t),m(n)?n.slice():[n]).filter((n,t,e)=>e.indexOf(n)===t));return n},N=(n,t,e,r,o)=>{let u=o.indexOf(t);if(-1!==u&&-1!==o.indexOf(t,u+1))return n;n=I(n,t);if(h(i,t))t[s](n,e,r,o.concat(t));else if(b(t))x(t,i=>{N(n?n[i]:void 0,t[i],S(e,i),r,o)});else{let i=E(t);if(i.some(t=>z(n,t,e,o)))return n;H(r,t,n,e)}return n},z=(n,t,e,r)=>{if(null==n)return n===t;if(b(t)||h(i,t)){let i=[];return N(n,t,e,i,r),!i.length}if(h(RegExp,t))return t.test(n);if(t===Number||t===Date)return n.constructor===t&&!isNaN(n);return n===t||g(t)&&h(t,n)||n.constructor===t},B=(n,t,e,i=t.errors)=>{for(let r of t.assertions){let o;try{o=r.call(t,n)}catch(n){o=n}if(!0!==o){let u=g(r.description)?r.description:(n,t)=>`assertion "${r.description}" returned ${C(n)} `+`for ${e?e+" =":"value"} ${C(t)}`;H(i,r,n,e,u.call(t,o,n,e))}}},I=(n,t=[])=>{if(!n||b(t)||j(n))return n;let e=E(t),r=[];for(let t of e)h(i,t)&&t.test(n)&&r.push(t);if(1===r.length)return r[0](n);r.length>1&&console.warn(`Ambiguous model for value ${C(n)}, could be ${r.join(" or ")}`);return n};A(t,i,{extend(...n){let e=G(new t(D(this.definition,n)),this);for(let i of n)h(t,i)&&e.assertions.push(...i.assertions);return e}}),A(e,i,{sealed:!1,defaults(n){return Object.assign(this.prototype,n),this},toString(n){return C(this.definition,n)},extend(...n){let t=this,r=Object.assign({},this.definition),o=[],u={};F(u,t.prototype,!1);for(let t of n)h(i,t)&&(F(r,t.definition,!0),o.push(...t.assertions)),g(t)&&F(u,t.prototype,!0),v(t)&&F(r,t,!0);let f=G(new e(r),t,u);return f.assertions=t.assertions.concat(o),d(t)!==e.prototype&&(f[c]=(n=>{let e=new t(n);F(n,e,!0);return n})),f},[s](n,t,e,i){if(v(n)){let r=this.definition;N(n,r,t,e,i),this.sealed&&T(n,r,e)}else H(e,this,n,t);B(n,this,t,e)}});let K=(n,t,e,i)=>b(e)?O(t,{getPrototypeOf:()=>i?a:d(t),get(t,r){if(!y(r))return Reflect.get(t,r);let o=S(i,r),u=e[r];return r in e&&n.conventionForPrivate(r)?(M(`access to private property ${o}`,n),void J(n)):(t[r]&&p(t,r)&&!b(u)&&!j(t[r])&&(t[r]=I(t[r],u)),g(t[r])&&t[r].bind?t[r].bind(t):(b(u)&&!t[r]&&(t[r]={}),K(n,t[r],u,o)))},set(t,r,o){return U(n,e,i,t,r,i=>{Reflect.set(t,r,K(n,o,e[r],i))})},deleteProperty(t,r){return U(n,e,i,t,r,()=>Reflect.deleteProperty(t,r))},defineProperty(t,r,o){return U(n,e,i,t,r,()=>Reflect.defineProperty(t,r,o))},has(t,i){return Reflect.has(t,i)&&Reflect.has(e,i)&&!n.conventionForPrivate(i)},ownKeys(){return Reflect.ownKeys(e).filter(t=>!n.conventionForPrivate(t))},getOwnPropertyDescriptor(t,i){let r;return n.conventionForPrivate(i)||void 0!==(r=Object.getOwnPropertyDescriptor(e,i))&&(r.value=t[i]),r}}):I(t,e),T=(n,t,e,i)=>{x(n,r=>{let o=n[r],u=S(i,r);p(t,r)?b(o)&&T(o,t[r],e,u):Z(u,o,e)})},U=(n,t,e,i,r,o)=>{let u=S(e,r),f=n.conventionForPrivate(r),c=n.conventionForConstant(r),s=p(i,r),a=s&&Object.getOwnPropertyDescriptor(i,r);r in t&&(f||c&&void 0!==i[r])&&M(`modify ${f?"private":"constant"} ${r}`,n);let l=p(t,r);l||!n.sealed?(o(u),l&&N(i[r],t[r],u,n.errors,[]),B(i,n,u)):Z(u,i[r],n.errors);let d=n.errors.length;d&&(s?Object.defineProperty(i,r,a):delete i[r],J(n));return!d},Z=(n,t,e)=>{e.push({path:n,received:t,message:`property ${n} is not declared in the sealed model definition`})};Object.assign(i.prototype,{name:"Model",assertions:[],conventionForConstant:n=>n.toUpperCase()===n,conventionForPrivate:n=>"_"===n[0],toString(n){return _(this.definition,n)},as(n){return k(this,"name",n),this},defaultTo(n){return this.default=n,this},[c]:n=>n,[s](n,t,e,i){N(n,this.definition,t,e,i),B(n,this,t,e)},validate(n,t){return this[s](n,null,this.errors,[]),!J(this,t)},test(n){let t,e=this.errorCollector;return this.errorCollector=(()=>{t=!0}),new this(n),this.errorCollector=e,!t},errorCollector(n){let t=new TypeError(n.map(n=>n.message).join("\n"));throw t.stack=t.stack.replace(/\n.*object-model(.|\n)*object-model.*/,""),t},assert(n,t=C(n)){return k(n,"description",t),this.assertions=this.assertions.concat(n),this}});let q=(n,t)=>{n.definition=t;n.assertions=[...n.assertions];k(n,"errors",[]);delete n.name},G=(n,t,e)=>{A(n,t,e);n.assertions.push(...t.assertions);return n},H=(n,t,e,i,r)=>{n.push({expected:t,received:e,path:i,message:r})},J=(n,t=n.errorCollector)=>{let e=n.errors.length;if(e>0){let e=n.errors.map(n=>{if(!n.message){let t=m(n.expected)?n.expected:[n.expected];n.message="expecting "+(n.path?n.path+" to be ":"")+t.map(n=>C(n)).join(" or ")+", got "+(null!=n.received?l(n.received)+" ":"")+C(n.received)}return n});n.errors=[],t.call(n,e)}return e},L=["pop","push","reverse","shift","sort","splice","unshift"];A(r,i,{toString(n){return"Array of "+_(this.definition,n)},[s](n,t,e,i){m(n)?n.forEach((r,o)=>{n[o]=N(r,this.definition,`${t||"Array"}[${o}]`,e,i)}):H(e,this,n,t),B(n,this,t,e)},extend(...n){return G(new r(D(this.definition,n)),this)}});let Q=(n,t,e,i)=>{let r=`Array[${t}]`;parseInt(t)===+t&&t>=0&&(e=N(e,i.definition,r,i.errors,[]));let o=n.slice();o[t]=e;B(o,i,r);let u=!J(i);u&&(n[t]=e);return u};A(o,i,{toString(n=[]){let t=`Function(${this.definition.arguments.map(t=>_(t,n.slice())).join(",")})`;return"return"in this.definition&&(t+=" => "+_(this.definition.return,n)),t},return(n){return this.definition.return=n,this},extend(n,t){let e=this.definition.arguments,i=n.map((t,i)=>D(i in e?e[i]:[],n[i])),r=D(this.definition.return,t);return G(new o(...i).return(r),this)},[s](n,t,e){g(n)||H(e,"Function",n,t)}}),o.prototype.assert(function(n){return!(n.length>this.definition.arguments.length)||n},function(n){return`expecting ${this.definition.arguments.length} arguments for ${C(this)}, got ${n.length}`});let V=["set","delete","clear"];A(u,i,{toString(n){let{key:key,value:value}=this.definition;return`Map of ${_(key,n)} : ${_(value,n)}`},[s](n,t,e,i){if(n instanceof Map){t=t||"Map";for(let[r,o]of n)N(r,this.definition.key,`${t} key`,e,i),N(o,this.definition.value,`${t}[${C(r)}]`,e,i)}else H(e,this,n,t);B(n,this,t,e)},extend(n,t){let{key:key,value:value}=this.definition;return G(new u(D(key,n),D(value,t)),this)}});let W=["add","delete","clear"];A(f,i,{toString(n){return"Set of "+_(this.definition,n)},[s](n,t,e,i){if(n instanceof Set)for(let r of n.values())N(r,this.definition,`${t||"Set"} value`,e,i);else H(e,this,n,t);B(n,this,t,e)},extend(...n){return G(new f(D(this.definition,n)),this)}}),n.Model=i,n.BasicModel=t,n.ObjectModel=e,n.ArrayModel=r,n.FunctionModel=o,n.MapModel=u,n.SetModel=f,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=object-model.min.js.map
